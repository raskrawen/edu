<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historie lærer-assistenten</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #chat-container {
            width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #chat-box {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        #chat-box p {
            margin: 5px 0;
        }
        #user-input {
            width: calc(100% - 60px);
            padding: 10px;
            margin-right: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #send-button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .loader {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #007bff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Skriv en besked...">
    <button id="send-button">Send</button>
</div>

<script>
    // Definer den skjulte prompt
    const hiddenPrompt = "skriv på dansk";

    // Array til at holde samtalebeskederne, inkl. den skjulte prompt
    let messages = [{ role: 'system', content: hiddenPrompt }];

    const sendButton = document.getElementById('send-button');
    const userInput = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');
  
    let terms = [];
    // Funktion for at vise beskeder
    function displayMessage(message) {
        const messageElement = document.createElement('p');
        messageElement.textContent = message;
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Funktion til at vise loader animation
    function showLoader() {
        const loader = document.createElement('div');
        loader.className = 'loader';
        loader.id = 'loader';
        chatBox.appendChild(loader);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Funktion til at fjerne loader animation
    function removeLoader() {
        const loader = document.getElementById('loader');
        if (loader) loader.remove();
    }

    // Asynkron funktion til at håndtere API-opkald
    async function getChatGPTResponse() {
        showLoader();

        try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer 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' // Erstat XXXXX med din API-nøgle
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: messages
                })
            });

            const data = await response.json();
            const botMessage = data.choices[0].message.content;

            // Tilføj ChatGPTs svar til samtalen
            messages.push({ role: 'assistant', content: botMessage });
            return botMessage;
        } catch (error) {
            return "Undskyld, der opstod en fejl. Prøv venligst igen.";
        } finally {
            removeLoader();
        }
    }

    // Funktion til at sende brugerens besked og modtage svar fra ChatGPT
    async function sendMessage() {
        const userInputValue = userInput.value.trim();
        if (!userInputValue) {
            alert('Please enter a message.');
            return;
        }
        let constPrompt = "Rolle: Du er en historie-lærer i dansk gymnasium stx gennem 15 år. Kontekst: Du skal være lærings-assistens for en elev. Du er interesseret i, at eleven lærer begreber, metoder og teorier i historie. Du vil lave quizzer med eleven. Du er opmærksom på, at du ikke vil løse opgaver for eleven, og du vil ikke skrive elevens produkter. Du vil hjælpe med at forklare og formidle viden i historie. Opgave: Hjælp elever med at lære historie-faget. Du spørger ind til elevens læring, interesser og fremskridt. Format: korte svar. Tone: Venlig og tålmodig."
        
        // Tilføj brugerens besked til samtalelisten
        messages.push({ role: 'user', content: userInputValue });
        messages.push({ role: 'system', content: constPrompt });
        
        // Vis brugerens besked
        displayMessage('Dig: ' + userInputValue);

        // Ryd inputfeltet
        userInput.value = '';

        // Hent ChatGPTs svar
        const response = await getChatGPTResponse();
        displayMessage('Historie assistenten: ' + response);
    }

    // Håndtering af knapklik
    sendButton.addEventListener('click', sendMessage);

    // Håndtering af "Enter"-tryk for at sende besked
    userInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
</script>

</body>
</html>
